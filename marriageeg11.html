<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Marriage Certificate Form (EN/HI)</title>
  <style>
    body { font-family:"Times New Roman", serif; margin:40px; }
    h2,h3 { text-align:center; margin:0; }
    h2 { font-style:italic; text-decoration:underline; }
    h3 { font-weight:bold; font-style:italic; }
    .form-row { margin:8px 0; }
    label { display:inline-block; width:280px; font-weight:bold; vertical-align:top; }
    input { padding:4px; width:260px; }
    hr { border:0; border-top:1px solid #000; margin:10px 0; }
    .footer { margin-top:30px; display:flex; justify-content:space-between; }
    #searchSection { margin-top:40px; padding:15px; border:1px solid #000; }
    #results { margin-top:15px; }
    .result-card { border:1px solid #bbb; padding:10px; margin:6px 0; }
    .btn { padding:6px 12px; border:none; border-radius:4px; cursor:pointer; margin-right:5px; }
    .btn-primary { background:#0d6efd; color:#fff; }
    .btn-print   { background:#28a745; color:#fff; }
    .btn-edit    { background:#ffc107; color:#000; }
    .btn-delete  { background:#dc3545; color:#fff; }
  </style>
</head>
<body>

  <h2>MARRIAGE CERTIFICATE <br> विवाह प्रमाण पत्र</h2>
  <h3>ST. JOSEPH'S CATHEDRAL <br> सेंट जोसेफ कैथेड्रल</h3>
  <h3>DIOCESE OF MEERUT <br> मेरठ धर्मप्रांत</h3>

  <hr>
  <div class="form-row">
    <label>Serial No. / क्रमांक:</label>
    <input type="text" id="serial">
    <label>Year / वर्ष:</label>
    <input type="text" id="year">
  </div>
  <hr>

  <form id="marriageForm">
    <input type="hidden" id="recordId" name="id"> <!-- hidden for edit/update -->

    <div class="form-row"><label>Date of Marriage / विवाह की तिथि:</label><input type="date" name="dateOfMarriage" required></div>
    <div class="form-row"><label>Place of Marriage / विवाह का स्थान:</label><input type="text" name="placeOfMarriage" required></div>
    <div class="form-row"><label>Bridegroom's Name / वर का नाम:</label><input type="text" name="groomName" required></div>
    <div class="form-row"><label>Bridegroom's Father's Name / वर के पिता का नाम:</label><input type="text" name="groomFather" required></div>
    <div class="form-row"><label>Bride's Name / वधू का नाम:</label><input type="text" name="brideName" required></div>
    <div class="form-row"><label>Bride's Father's Name / वधू के पिता का नाम:</label><input type="text" name="brideFather" required></div>
    <div class="form-row"><label>Witness 1 / गवाह 1:</label><input type="text" name="witness1"></div>
    <div class="form-row"><label>Witness 2 / गवाह 2:</label><input type="text" name="witness2"></div>
    <div class="form-row"><label>Minister's Name / मंत्री का नाम:</label><input type="text" name="minister" required></div>

    <hr>
    <button class="btn btn-primary" type="submit">Save / Update Form</button>
    <button class="btn" type="reset" onclick="resetForm()">Reset / रीसेट</button>
  </form>

  <div class="footer">
    <div>Parochial Seal <br> पेरोकियल सील</div>
    <div>Date / दिनांक</div>
    <div>Father-in-charge <br> प्रभारी फादर</div>
  </div>

  <!-- Search Section -->
  <div id="searchSection">
    <h3>Search Marriage Certificate / विवाह प्रमाण पत्र खोजें</h3>
    <div class="form-row">
      <label>Search by Groom or Bride Name / नाम से खोजें:</label>
      <input type="text" id="searchName" placeholder="e.g., John or Mary">
    </div>
    <div class="form-row">
      <label>Or by Serial No. / या क्रमांक:</label>
      <input type="text" id="searchSerial" placeholder="e.g., 456">
    </div>
    <button class="btn btn-primary" id="searchBtn" type="button">Search / खोजें</button>
    <div id="results"></div>
  </div>

  <script>
    const LS_KEY = "marriageForms";

    function getForms() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch { return []; }
    }
    function setForms(arr) {
      localStorage.setItem(LS_KEY, JSON.stringify(arr));
    }

    // Save or update
    document.getElementById("marriageForm").addEventListener("submit", function(e){
      e.preventDefault();

      const idField = document.getElementById("recordId");
      let all = getForms();
      let data = { id: idField.value || Date.now().toString() };

      new FormData(this).forEach((v,k)=> data[k] = v);
      data.serial = document.getElementById("serial").value.trim();
      data.year   = document.getElementById("year").value.trim();

      if(idField.value){ 
        all = all.map(f => f.id === data.id ? data : f);
        alert("Record updated successfully!");
      } else {
        all.push(data);
        alert("Form saved successfully!");
      }

      setForms(all);
      resetForm();
      renderResults();
    });

    function resetForm(){
      document.getElementById("marriageForm").reset();
      document.getElementById("recordId").value = "";
      document.getElementById("serial").value = "";
      document.getElementById("year").value = "";
    }

    // Search
    const searchName   = document.getElementById("searchName");
    const searchSerial = document.getElementById("searchSerial");
    const resultsDiv   = document.getElementById("results");

    document.getElementById("searchBtn").addEventListener("click", renderResults);
    searchName.addEventListener("input", renderResults);
    searchSerial.addEventListener("input", renderResults);

    function renderResults() {
      const qName   = searchName.value.trim().toLowerCase();
      const qSerial = searchSerial.value.trim().toLowerCase();
      const forms   = getForms();

      const matches = forms.filter(f => {
        const groomHit = qName ? (f.groomName || "").toLowerCase().includes(qName) : false;
        const brideHit = qName ? (f.brideName || "").toLowerCase().includes(qName) : false;
        const serialHit = qSerial ? (String(f.serial || "").toLowerCase().includes(qSerial)) : false;
        return (qName || qSerial) ? (groomHit || brideHit || serialHit) : true;
      });

      resultsDiv.innerHTML = matches.length
        ? `<p><b>${matches.length}</b> record(s) found.</p>` : "<p>No records found.</p>";

      matches.forEach(rec => {
        const div = document.createElement("div");
        div.className = "result-card";
        div.innerHTML = `
          <p><b>Groom:</b> ${rec.groomName || "-"} &nbsp; | &nbsp;
             <b>Bride:</b> ${rec.brideName || "-"} &nbsp; | &nbsp;
             <b>Serial:</b> ${rec.serial || "-"} &nbsp; | &nbsp;
             <b>Year:</b> ${rec.year || "-"}</p>
          <button class="btn btn-print" onclick="printCertificate('${rec.id}')">Print</button>
          <button class="btn btn-edit" onclick="editCertificate('${rec.id}')">Edit</button>
          <button class="btn btn-delete" onclick="deleteCertificate('${rec.id}')">Delete</button>
        `;
        resultsDiv.appendChild(div);
      });
    }

    // Edit
    function editCertificate(id){
      const rec = getForms().find(r => r.id === id);
      if(!rec){ alert("Record not found."); return; }

      document.getElementById("recordId").value = rec.id;
      document.getElementById("serial").value = rec.serial || "";
      document.getElementById("year").value   = rec.year || "";

      const form = document.getElementById("marriageForm");
      for(const [k,v] of Object.entries(rec)){
        if(form.elements[k]) form.elements[k].value = v;
      }
      window.scrollTo({top:0, behavior:"smooth"});
    }

    // Delete
    function deleteCertificate(id){
      if(!confirm("Are you sure you want to delete this record?")) return;
      let all = getForms().filter(r => r.id !== id);
      setForms(all);
      renderResults();
      alert("Record deleted successfully!");
    }

    // Print
    function printCertificate(id){
      const rec = getForms().find(r => r.id === id);
      if(!rec){ alert("Record not found."); return; }

      const w = window.open("", "_blank", "width=900,height=700");
      w.document.write(`
        <html><head><title>Marriage Certificate</title></head>
        <body style="font-family:'Times New Roman',serif; margin:40px;">
          <h2 style="text-align:center; text-decoration:underline;">MARRIAGE CERTIFICATE <br> विवाह प्रमाण पत्र</h2>
          <h3 style="text-align:center;">ST. JOSEPH'S CATHEDRAL <br> सेंट जोसेफ कैथेड्रल</h3>
          <h3 style="text-align:center;">DIOCESE OF MEERUT <br> मेरठ धर्मप्रांत</h3>
          <hr>
          <p><center><b>Serial No. / क्रमांक:</b> ${rec.serial || ""} &nbsp;&nbsp;
             <b>Year / वर्ष:</b> ${rec.year || ""}</center></p>
          <hr>
          <p><b>Date of Marriage / विवाह की तिथि:</b> <U><font size=6>${rec.dateOfMarriage || ""}</font></U></p>
          <p><b>Place of Marriage / विवाह का स्थान:</b> <U><font size=6>${rec.placeOfMarriage || ""}</font></U></p>
          <p><b>Bridegroom's Name / वर का नाम:</b> <U><font size=6>${rec.groomName || ""}</font></U></p>
          <p><b>Father's Name / पिता का नाम:</b> <U><font size=6>${rec.groomFather || ""}</font></U></p>
          <p><b>Bride's Name / वधू का नाम:</b> <U><font size=6>${rec.brideName || ""}</font></U></p>
          <p><b>Father's Name / पिता का नाम:</b> <U><font size=6>${rec.brideFather || ""}</font></U></p>
          <p><b>Witness 1 / गवाह 1:</b> <U><font size=6>${rec.witness1 || ""}</font></U></p>
          <p><b>Witness 2 / गवाह 2:</b> <U><font size=6>${rec.witness2 || ""}</font></U></p>
          <p><b>Minister's Name / मंत्री का नाम:</b> <U><font size=6>${rec.minister || ""}</font></U></p>

          <hr>
          <div style="display:flex; justify-content:space-between; margin-top:30px;">
            <br><br>
            <div>Parochial Seal <br> पेरोकियल सील</div>
            <div>Date / दिनांक</div>
            <div>Father-in-charge <br> प्रभारी फादर</div>
          </div>
          <script>window.print();<\/script>
        </body></html>
      `);
      w.document.close();
    }

    renderResults();
  </script>
</body>
</html>
